{"version":3,"sources":["webpack:///webpack/bootstrap 97ac8f19589309421455","webpack:///./src/index.ts","webpack:///./src/factory/httpInterceptorQueue.ts","webpack:///./src/decorator/log.ts","webpack:///./src/decorator/exceptionHandler.ts","webpack:///./src/factory/engineQueue.ts","webpack:///./src/decorator/q2.ts","webpack:///./src/factory/Counter.ts"],"names":[],"mappings":";AAAA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA,uBAAe;AACf;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;;AAGA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;;;;;;ACtCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EAAC;AACD;AACA;AACA;AACA;AACA,UAAS;AACT;AACA;AACA;AACA;AACA,cAAa;AACb,UAAS;AACT,wCAAuC,WAAW,EAAE;AACpD,wCAAuC,eAAe,EAAE,uBAAuB,EAAE;AACjF,4CAA2C,UAAU,cAAc,EAAE;AACrE;AACA,EAAC;;;;;;;ACpCD;AACA;AACA;AACA;AACA;AACA;AACA;AACA,UAAS;AACT;AACA;AACA;AACA,UAAS;AACT;AACA;AACA;AACA,UAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA,+CAA8C,cAAc;AAC5D;;;;;;;ACvBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,6BAA4B,uBAAuB;AACnD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,kBAAiB;AACjB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iCAAgC,uBAAuB;AACvD;AACA;AACA;AACA,cAAa;AACb;AACA;AACA,iCAAgC,uBAAuB;AACvD;AACA;AACA;AACA,cAAa;AACb;AACA;AACA,iCAAgC,uBAAuB;AACvD;AACA;AACA;AACA,cAAa;AACb;AACA;AACA,iCAAgC,uBAAuB;AACvD;AACA;AACA;AACA,cAAa;AACb;AACA;AACA,iCAAgC,uBAAuB;AACvD;AACA;AACA;AACA,cAAa;AACb;AACA;AACA,iCAAgC,uBAAuB;AACvD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,+CAA8C,cAAc;AAC5D;;;;;;;ACnFA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,+CAA8C,cAAc;AAC5D;;;;;;;ACjBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EAAC;AACD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,+CAA8C,cAAc;AAC5D;;;;;;;AChDA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,+CAA8C,cAAc;AAC5D;;;;;;;AClDA;AACA;AACA;AACA;AACA;AACA,mCAAkC;AAClC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,cAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EAAC;AACD,+CAA8C,cAAc;AAC5D","file":"dist/angular.js-server.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n/** WEBPACK FOOTER **\n ** webpack/bootstrap 97ac8f19589309421455\n **/","\"use strict\";\nvar httpInterceptorQueue_1 = require('./factory/httpInterceptorQueue');\nvar log_1 = require('./decorator/log');\nvar exceptionHandler_1 = require('./decorator/exceptionHandler');\nvar engineQueue_1 = require('./factory/engineQueue');\nvar q2_1 = require('./decorator/q2');\nvar Counter_1 = require('./factory/Counter');\nvar serverModule = angular.module('server', [])\n    .constant('TimeoutValue', 500)\n    .config(function ($provide, $httpProvider, $windowProvider) {\n    var $window = $windowProvider.$get();\n    if (typeof $window.onServer !== 'undefined' && $window.onServer === true) {\n        $provide.factory('counter', Counter_1.default);\n        $provide.factory('engineQueue', engineQueue_1.default);\n        $provide.decorator('$q', q2_1.default);\n        $provide.decorator('$exceptionHandler', exceptionHandler_1.default);\n        $provide.decorator('$log', log_1.default);\n        $provide.factory('httpInterceptorQueue', httpInterceptorQueue_1.default);\n        $httpProvider.interceptors.push('httpInterceptorQueue');\n    }\n}).run(function ($rootScope, $q, $http, $injector, $window) {\n    if (typeof $window.onServer !== 'undefined' && $window.onServer === true) {\n        var counter = $injector.get('counter', 'angular.js-module run()');\n        counter.create('digest', function () {\n            digestWatcher();\n        });\n        var digestWatcher = $rootScope.$watch(function () {\n            counter.incr('digest');\n            $rootScope.$$postDigest(function () {\n                counter.decr('digest');\n            });\n        });\n        $rootScope.$apply(function () { var i = 0; });\n        $q(function (resolve, reject) { resolve(true); }).then(function (res) { });\n        $http.get('/someInexistantValue', { config: { timeout: 10 } });\n    }\n});\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./src/index.ts\n ** module id = 0\n ** module chunks = 0\n **/","'use strict';\nvar HttpInterceptorQueue = function ($q, $window, $rootScope, TimeoutValue, counter) {\n    var hCounter = counter.create('http');\n    return {\n        request: function (config) {\n            hCounter.incr();\n            return $q.when(config);\n        },\n        requestError: function (rejection) {\n            hCounter.decr();\n            return $q.reject(rejection);\n        },\n        response: function (response) {\n            hCounter.decr();\n            return $q.when(response);\n        },\n        responseError: function (response) {\n            hCounter.decr();\n            return $q.reject(response);\n        }\n    };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.default = HttpInterceptorQueue;\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./src/factory/httpInterceptorQueue.ts\n ** module id = 1\n ** module chunks = 0\n **/","'use strict';\nvar logDecorator = function ($delegate, $window) {\n    if (typeof window['onServer'] !== 'undefined' && window['onServer'] === true && typeof window['fs'] !== 'undefined' && typeof window['logConfig'] !== 'undefined') {\n        var fs_1 = window['fs'];\n        var config_1 = window['logConfig'];\n        var formatMsg_1 = function (msg) {\n            var date = new Date();\n            return date + \" -> \" + msg.join(' ') + '\\n';\n        };\n        var log_1 = function (type) {\n            var args = [];\n            for (var _i = 1; _i < arguments.length; _i++) {\n                args[_i - 1] = arguments[_i];\n            }\n            if (config_1[type].enabled) {\n                var msg = formatMsg_1(args);\n                if (config_1[type].stack === true) {\n                    var err = new Error();\n                    var stack = err['stack'];\n                    msg += stack + '\\n\\n';\n                }\n                fs_1.appendFile(config_1.dir + '/' + type, msg, function (err) {\n                    if (err)\n                        throw err;\n                });\n            }\n            else {\n                $delegate[type].apply($window.console, args);\n            }\n        };\n        var timer = Date.now();\n        var myLog = {\n            formatMsg: formatMsg_1,\n            warn: function () {\n                var args = [];\n                for (var _i = 0; _i < arguments.length; _i++) {\n                    args[_i - 0] = arguments[_i];\n                }\n                log_1('warn', args);\n            },\n            error: function () {\n                var args = [];\n                for (var _i = 0; _i < arguments.length; _i++) {\n                    args[_i - 0] = arguments[_i];\n                }\n                log_1('error', args);\n            },\n            info: function () {\n                var args = [];\n                for (var _i = 0; _i < arguments.length; _i++) {\n                    args[_i - 0] = arguments[_i];\n                }\n                log_1('info', args);\n            },\n            debug: function () {\n                var args = [];\n                for (var _i = 0; _i < arguments.length; _i++) {\n                    args[_i - 0] = arguments[_i];\n                }\n                log_1('debug', args);\n            },\n            log: function () {\n                var args = [];\n                for (var _i = 0; _i < arguments.length; _i++) {\n                    args[_i - 0] = arguments[_i];\n                }\n                log_1('log', args);\n            },\n            dev: function () {\n                var args = [];\n                for (var _i = 0; _i < arguments.length; _i++) {\n                    args[_i - 0] = arguments[_i];\n                }\n                return;\n            }\n        };\n        return myLog;\n    }\n    else {\n        return $delegate;\n    }\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.default = logDecorator;\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./src/decorator/log.ts\n ** module id = 2\n ** module chunks = 0\n **/","'use strict';\nvar ExceptionHandler = function ($delegate, $log, $window) {\n    var errorHandler = function (error, cause) {\n        var err = new Error();\n        var stack = err['stack'];\n        var errorEvent = new $window.CustomEvent('ServerExceptionHandler');\n        errorEvent.details = {\n            exception: error,\n            cause: cause,\n            err: stack\n        };\n        $window.dispatchEvent(errorEvent);\n        return $delegate(error, cause);\n    };\n    return errorHandler;\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.default = ExceptionHandler;\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./src/decorator/exceptionHandler.ts\n ** module id = 3\n ** module chunks = 0\n **/","\"use strict\";\nvar IdleEvent = (function () {\n    function IdleEvent() {\n    }\n    IdleEvent.Send = function ($window) {\n        var Event = $window['Event'];\n        var dispatchEvent = $window.dispatchEvent;\n        var IdleEvent = new Event('Idle');\n        dispatchEvent(IdleEvent);\n    };\n    return IdleEvent;\n}());\nvar EngineQueue = function ($log, $window) {\n    var doneVar = {};\n    var setStatus = function (name, value) {\n        if (isDone) {\n            return;\n        }\n        doneVar[name] = value;\n        if (value === true) {\n            done(name);\n        }\n    };\n    var isDone = false;\n    var areDoneVarAllTrue = function () {\n        for (var key in doneVar) {\n            if (!doneVar[key]) {\n                return false;\n            }\n        }\n        return true;\n    };\n    var done = function (from) {\n        if (isDone) {\n            return isDone;\n        }\n        if (areDoneVarAllTrue()) {\n            isDone = true;\n            IdleEvent.Send($window);\n        }\n        return isDone;\n    };\n    return {\n        isDone: done,\n        setStatus: setStatus\n    };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.default = EngineQueue;\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./src/factory/engineQueue.ts\n ** module id = 4\n ** module chunks = 0\n **/","'use strict';\nvar Q = function ($delegate, $rootScope, TimeoutValue, counter) {\n    var qCounter = counter.create('q');\n    var proto = $delegate.prototype;\n    var Odefer = $delegate.defer;\n    var Oreject = $delegate.reject;\n    var Orace = $delegate.race;\n    var Oall = $delegate.all;\n    var Oresolve = $delegate.resolve;\n    var deferFn = function (context) {\n        return function () {\n            var deferred = Odefer.apply(context, []);\n            var originalDeferResolve = deferred.resolve;\n            deferred.resolve = function () {\n                qCounter.decr();\n                return originalDeferResolve.apply(deferred, arguments);\n            };\n            var originalDeferReject = deferred.reject;\n            deferred.reject = function () {\n                qCounter.decr();\n                return originalDeferReject.apply(deferred, arguments);\n            };\n            qCounter.incr();\n            return deferred;\n        };\n    };\n    var $Q = function (resolver) {\n        if (typeof resolver !== 'function') {\n            throw new Error('norslvr - Expected resolverFn, got - resolver');\n        }\n        var deferred = deferFn(this)();\n        function resolveFn(value) {\n            deferred.resolve(value);\n        }\n        function rejectFn(reason) {\n            deferred.reject(reason);\n        }\n        resolver(resolveFn, rejectFn);\n        return deferred.promise;\n    };\n    $Q.prototype = proto;\n    $Q.defer = deferFn($delegate);\n    $Q.reject = $delegate.reject;\n    $Q.when = $delegate.when;\n    $Q.resolve = Oresolve;\n    $Q.all = Oall;\n    $Q.race = Orace;\n    return $Q;\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.default = Q;\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./src/decorator/q2.ts\n ** module id = 5\n ** module chunks = 0\n **/","\"use strict\";\nvar CounterFactory = function ($rootScope, $log, engineQueue, TimeoutValue) {\n    var counters = {};\n    var createCounter = function (name, doneCB) {\n        if (!doneCB) {\n            doneCB = function () { };\n        }\n        counters[name] = new Counter(name, doneCB, $rootScope, engineQueue, TimeoutValue, $log);\n        return counters[name];\n    };\n    var getCounter = function (name) {\n        return counters[name];\n    };\n    var incr = function (name) {\n        counters[name].incr();\n    };\n    var decr = function (name) {\n        counters[name].decr();\n    };\n    var getCount = function (name) {\n        return counters[name].getCount();\n    };\n    return {\n        create: createCounter,\n        incr: incr,\n        decr: decr,\n        getCount: getCount\n    };\n};\nvar Counter = (function () {\n    function Counter(name, doneCB, $rootScope, engineQueue, TimeoutValue, $log) {\n        var _this = this;\n        this.name = name;\n        this.doneCB = doneCB;\n        this.$rootScope = $rootScope;\n        this.engineQueue = engineQueue;\n        this.TimeoutValue = TimeoutValue;\n        this.$log = $log;\n        this.timer = Date.now();\n        this.getCount = function () {\n            return _this.count;\n        };\n        this.isDone = function () {\n            return _this.done;\n        };\n        this.clearTimeout = function () {\n            if (typeof _this.timeout !== 'undefined') {\n                _this.$log.dev(_this.name, 'Timeout cleared', _this.timeout);\n                _this.timeout = window.clearTimeout(_this.timeout);\n            }\n        };\n        this.incr = function () {\n            if (_this.done) {\n                return;\n            }\n            _this.count++;\n            if (_this.name !== 'digest') {\n                _this.$log.dev(_this.name, 'Incrementing counter ', _this.count);\n            }\n            _this.$log.dev(_this.name, 'Incrementing counter ', _this.count);\n            _this.engineQueue.setStatus(_this.name, false);\n            _this.clearTimeout();\n        };\n        this.decr = function () {\n            if (_this.done) {\n                return;\n            }\n            _this.count--;\n            if (_this.name !== 'digest') {\n                _this.$log.dev(_this.name, 'Decrementing counter ', _this.count);\n            }\n            _this.engineQueue.setStatus(_this.name, false);\n            _this.clearTimeout();\n            if (_this.count === 0) {\n                _this.triggerIdle();\n            }\n        };\n        this.triggerIdle = function () {\n            _this.clearTimeout();\n            _this.$log.dev(_this.name, 'triggerIdle called', _this.count, _this.TimeoutValue);\n            _this.timeout = window.setTimeout(function () {\n                if (this.count === 0) {\n                    this.$log.dev(this.name, 'setting the doneVar to true', this.count);\n                    this.engineQueue.setStatus(this.name, true);\n                    if (this.engineQueue.isDone()) {\n                        this.done = true;\n                        this.$log.dev(this.name, 'calling CB()');\n                        this.doneCB();\n                    }\n                }\n                else {\n                    this.$log.dev(this.name, 'triggerIdle cancelled ', this.count);\n                    this.engineQueue.setStatus(this.name, false);\n                }\n            }.bind(_this), _this.TimeoutValue);\n            _this.$log.dev(_this.name, 'timeout set to', _this.timeout);\n        };\n        this.done = false;\n        this.count = 0;\n        this.engineQueue.setStatus(this.name, false);\n    }\n    return Counter;\n}());\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.default = CounterFactory;\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./src/factory/Counter.ts\n ** module id = 6\n ** module chunks = 0\n **/"],"sourceRoot":""}